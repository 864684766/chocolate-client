"use strict";const e=require("electron"),l=require("path"),p=require("url"),a=require("fs");var r=typeof document<"u"?document.currentScript:null,i={};const u=p.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:r&&r.tagName.toUpperCase()==="SCRIPT"&&r.src||new URL("main/index.cjs",document.baseURI).href),n=l.dirname(u),d="Chocolate Client",f=!e.app.isPackaged;function b(){if(i.VITE_DEV_PORT)return i.VITE_DEV_PORT;const o=l.join(n,"../.vite-port");if(a.existsSync(o))try{const t=a.readFileSync(o,"utf-8").trim();if(t)return t}catch(t){console.warn(`Failed to read port file: ${t}`)}return"5173"}const m=b();function s(){const o=new e.BrowserWindow({width:1200,height:800,minWidth:800,minHeight:600,title:d,webPreferences:{preload:l.join(n,"../preload/index.cjs"),contextIsolation:!0,sandbox:!0,nodeIntegration:!1,webSecurity:!0}});return f?(o.loadURL(`http://localhost:${m}`),o.webContents.openDevTools()):o.loadFile(l.join(n,"../dist/index.html")),_(),o}function h(){s()}function w(){process.platform!=="darwin"&&e.app.quit()}function g(){e.BrowserWindow.getAllWindows().length===0&&s()}function _(o){const t=[{label:"文件",submenu:[{label:"退出",accelerator:process.platform==="darwin"?"Cmd+Q":"Ctrl+Q",click:()=>{e.app.quit()}}]},{label:"编辑",submenu:[{role:"undo",label:"撤销"},{role:"redo",label:"重做"},{type:"separator"},{role:"cut",label:"剪切"},{role:"copy",label:"复制"},{role:"paste",label:"粘贴"}]},{label:"视图",submenu:[{role:"reload",label:"重新加载"},{role:"forceReload",label:"强制重新加载"},{role:"toggleDevTools",label:"切换开发者工具"},{type:"separator"},{role:"resetZoom",label:"实际大小"},{role:"zoomIn",label:"放大"},{role:"zoomOut",label:"缩小"},{type:"separator"},{role:"togglefullscreen",label:"切换全屏"}]},{label:"帮助",submenu:[{label:"关于",click:()=>{console.log("关于应用")}}]}];process.platform==="darwin"&&t.unshift({label:e.app.getName(),submenu:[{role:"about",label:"关于"},{type:"separator"},{role:"services",label:"服务"},{type:"separator"},{role:"hide",label:"隐藏"},{role:"hideOthers",label:"隐藏其他"},{role:"unhide",label:"显示全部"},{type:"separator"},{role:"quit",label:"退出"}]});const c=e.Menu.buildFromTemplate(t);e.Menu.setApplicationMenu(c)}function y(){e.ipcMain.handle("app:getVersion",()=>e.app.getVersion()),e.ipcMain.handle("app:getPlatform",()=>process.platform)}e.app.whenReady().then(()=>{y(),h()});e.app.on("window-all-closed",w);e.app.on("activate",g);
